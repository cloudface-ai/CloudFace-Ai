<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CloudFace AI</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Chart.js for beautiful charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            --primary: #1a73e8;
            --primary-light: #4285f4;
            --primary-dark: #1557b0;
            --accent: #34a853;
            --success: #34a853;
            --warning: #fbbc04;
            --error: #ea4335;
            --bg: #f8f9fa;
            --surface: #ffffff;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-tertiary: #9aa0a6;
            --border: #e8eaed;
            --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-hover: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
            --radius: 8px;
            --radius-sm: 4px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f0fe 100%);
        }

        .dashboard-header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .dashboard-title {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .dashboard-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .dashboard-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.photos { background: linear-gradient(135deg, var(--primary), var(--primary-light)); }
        .stat-icon.links { background: linear-gradient(135deg, var(--accent), #4caf50); }
        .stat-icon.downloads { background: linear-gradient(135deg, var(--warning), #ff9800); }
        .stat-icon.views { background: linear-gradient(135deg, #9c27b0, #e91e63); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--error); }
        .stat-change.neutral { color: var(--text-tertiary); }

        .charts-grid {
            display: none;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-container {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .chart-canvas {
            position: relative;
            height: 300px;
        }

        .recent-activity {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .link-management {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .link-item {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.7rem;
            margin: 0;
            max-width: none;
            transition: all 0.2s ease;
        }

        .link-item:hover {
            box-shadow: var(--shadow-hover);
            border-color: var(--primary-light);
        }

        .link-header {
            display: flex;
            justify-content: flex-start;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .link-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .link-meta {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .event-preview {
            margin: 0.5rem 0;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: #f8f9fa;
            overflow: hidden;
            height: 230px;
            position: relative;
        }

        .event-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: 50% 50%;
            display: block;
            cursor: grab;
            user-select: none;
            -webkit-user-drag: none;
        }

        .event-preview img.dragging {
            cursor: grabbing;
        }

        .preview-drag-hint {
            position: absolute;
            right: 8px;
            bottom: 8px;
            background: rgba(0, 0, 0, 0.55);
            color: #fff;
            font-size: 0.75rem;
            padding: 0.25rem 0.45rem;
            border-radius: 10px;
            pointer-events: none;
        }

        .event-preview-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            font-size: 0.9rem;
            background: #f8f9fa;
        }

        .link-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        #adminLinksList {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 0.85rem;
            align-items: start;
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-small:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn-copy {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .btn-danger {
            background: var(--error);
            color: white;
            border-color: var(--error);
        }

        .btn-copy:hover {
            background: #2d7d32;
            border-color: #2d7d32;
        }

        .share-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }

        .share-modal.show {
            display: flex;
        }

        .share-modal-content {
            width: min(560px, 100%);
            background: var(--surface);
            border-radius: var(--radius);
            padding: 1.25rem;
            box-shadow: var(--shadow-hover);
            border: 1px solid var(--border);
        }

        .share-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .share-link-box {
            background: #e8f5e8;
            color: #2e7d32;
            border-radius: var(--radius-sm);
            padding: 0.65rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            word-break: break-all;
            margin-bottom: 0.75rem;
        }

        .share-modal-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .qr-wrap {
            text-align: center;
            background: #f8f9fa;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.75rem;
        }

        .qr-wrap img {
            width: 220px;
            height: 220px;
            object-fit: contain;
            background: white;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.35rem;
        }

        .edit-form-grid {
            display: grid;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .edit-form-grid label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: block;
            margin-bottom: 0.25rem;
        }

        .edit-form-grid input {
            width: 100%;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 0.6rem;
            font-size: 0.95rem;
        }

        .edit-watermark-wrap {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 0.9rem;
            align-items: start;
        }

        .wm-toggle-label {
            display: flex !important;
            justify-content: flex-start;
            align-items: center;
            gap: 8px;
            margin: 0;
        }

        .edit-form-grid input[type="checkbox"] {
            width: auto;
            padding: 0;
            margin: 0;
            flex: 0 0 auto;
        }

        .edit-watermark-preview-panel {
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: #f8f9fa;
            padding: 0.6rem;
        }

        .edit-watermark-preview-canvas {
            position: relative;
            width: 100%;
            height: 220px;
            border-radius: 6px;
            overflow: hidden;
            background: #e9ecef;
            border: 1px solid var(--border);
        }

        .edit-watermark-preview-canvas img.base {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .edit-watermark-overlay {
            position: absolute;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: white;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.55);
            font-weight: 600;
            pointer-events: none;
        }

        .edit-watermark-overlay img {
            display: none;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.6);
        }

        @media (max-width: 980px) {
            .edit-watermark-wrap {
                grid-template-columns: 1fr;
            }
        }

        /* User Profile Card */
        .profile-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-hover);
            color: white;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .profile-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .profile-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .plan-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .usage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .usage-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
        }

        .usage-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .usage-value {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .usage-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .usage-bar-fill {
            height: 100%;
            background: white;
            transition: width 0.3s ease;
        }

        .btn-upgrade {
            background: white;
            color: var(--primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: 1rem;
        }

        .btn-upgrade:hover {
            background: #f5f5f5;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Hide Recent Activity section for now */
        .recent-activity {
            display: none;
        }

        .activity-item {
            display: flex;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.2rem;
            color: white;
        }

        .activity-icon.photos { background: var(--primary); }
        .activity-icon.links { background: var(--accent); }
        .activity-icon.downloads { background: var(--warning); }
        .activity-icon.views { background: #9c27b0; }

        .activity-content {
            flex: 1;
        }

        .activity-description {
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .activity-time {
            font-size: 0.85rem;
            color: var(--text-tertiary);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            color: var(--error);
            background: #fef7f7;
            border: 1px solid #fce8e6;
            padding: 1rem;
            border-radius: var(--radius);
            margin: 1rem 0;
        }

        .refresh-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-sm);
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .refresh-btn:hover {
            background: var(--primary-dark);
        }

        .time-filter {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .time-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .time-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .time-btn:hover:not(.active) {
            border-color: var(--primary);
            color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-tertiary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .dashboard-content {
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .chart-canvas {
                height: 250px;
            }
            
            .dashboard-header {
                padding: 1rem;
            }
            
            .dashboard-title {
                font-size: 1.5rem;
            }

            #adminLinksList {
                grid-template-columns: 1fr;
            }
        }

        /* /app header/footer styles (verbatim structure) */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            -webkit-backdrop-filter: blur(20px);
            backdrop-filter: blur(20px);
            background: rgba(255,255,255,.95);
        }
        .header-top {
            background: var(--primary);
            color: #fff;
            padding: 4px 0;
            font-size: 12px;
            text-align: center;
        }
        .header-top a {
            color: #fff;
            text-decoration: none;
            margin: 0 8px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .header-top svg {
            width: 14px;
            height: 14px;
            fill: currentColor;
        }
        .header-main {
            padding: 1px 0;
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: .5rem;
        }
        .logo {
            font-size: 18px;
            font-weight: 500;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .nav-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
            display: none;
            align-items: center;
            justify-content: center;
        }
        .nav-toggle svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
        .nav-toggle:hover {
            background: var(--bg);
        }
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
            list-style: none;
        }
        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            padding: .5rem 1rem;
            border-radius: var(--radius-sm);
        }
        .nav-menu a:hover {
            color: var(--primary);
            background: var(--bg);
        }
        .nav-menu a.active {
            color: var(--primary);
            background: var(--bg);
        }
        .cta-button {
            background: var(--primary);
            color: #fff;
            padding: .75rem 1.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 600;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        .footer {
            background: var(--surface);
            border-top: 1px solid var(--border);
            margin-top: 4rem;
        }
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .footer-section h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 18px;
            font-weight: 600;
        }
        .footer-section p {
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }
        .footer-section ul {
            list-style: none;
        }
        .footer-section ul li {
            margin-bottom: 0.5rem;
        }
        .footer-section ul li a {
            color: var(--text-secondary);
            text-decoration: none;
        }
        .footer-section ul li a:hover {
            color: var(--primary);
        }
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--bg);
            border-radius: 50%;
            color: var(--text-secondary);
        }
        .social-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        .social-link svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        .footer-bottom {
            border-top: 1px solid var(--border);
            padding: 1.5rem 0;
        }
        .footer-bottom-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .footer-left p {
            color: var(--text-tertiary);
            font-size: 14px;
            margin: 0 0 0.25rem 0;
            line-height: 1.4;
        }
        .footer-left p .heart {
            color: #e74c3c;
        }
        .footer-left p:last-child {
            margin-bottom: 0;
        }
        .footer-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
        }
        .footer-links a:hover {
            color: var(--primary);
        }
        @media (max-width: 768px) {
            .nav-toggle {
                display: flex;
            }
            .nav-menu {
                display: none;
                flex-direction: column;
                width: 100%;
                gap: 0.5rem;
                padding: 1rem 0;
            }
            .nav-menu.active {
                display: flex;
            }
            .nav-menu a {
                padding: 0.75rem 1rem;
                width: 100%;
                text-align: center;
            }
            .footer-bottom-content {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
    <link rel="stylesheet" href="/static/pwa-install.css">
    <script src="/static/pwa-install.js?v=4" defer></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <span>Find any photo in your cloud with AI‚Äîinstantly</span>
        </div>
        <div class="header-main">
            <div class="container">
                <div class="header-content">
                    <a href="/" class="logo">
                        <img src="/static/Cloudface-ai-logo.png" alt="Cloudface AI" style="height:1.3em; width:auto; vertical-align:middle;">
                        <span style="margin-left:.4em;">Cloudface AI</span>
                    </a>
                    <button class="nav-toggle" onclick="toggleNav()" aria-label="Toggle navigation menu">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                        </svg>
                    </button>
                    <nav class="nav-menu" id="navMenu">
                        <a href="/" class="active">Home</a>
                        <a href="/my-photos" id="myPhotosBtn" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px; vertical-align: middle;">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21,15 16,10 5,21"/>
                            </svg>
                            My Photos
                        </a>
                        <a href="/about">About</a>
                        <a href="/video-app">Video Search</a>
                        <a href="/blog">Blog</a>
                        <a href="/pricing">Pricing</a>
                        <!-- How It Works removed from app page -->
                        <a href="/#features">Features</a>
                        <a href="/image-tools">Image Tool</a>
                        <a href="/admin/dashboard" style="color: var(--accent); font-weight: 600;">Admin</a>
                        <a href="/app" class="cta-button">Try App</a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Admin Dashboard</h1>
            <p class="dashboard-subtitle">Real-time analytics and insights for CloudFace AI</p>
        </div>

        <div class="dashboard-content">
            <!-- User Profile Card -->
            <div class="profile-card">
                <div class="profile-header">
                    <div>
                        <div class="profile-title" id="profileUserName">Loading...</div>
                        <div class="profile-subtitle">Photo Management Dashboard</div>
                    </div>
                    <div class="plan-badge" id="profilePlanBadge">Plan</div>
                </div>
                
                <div class="usage-stats">
                    <div class="usage-item">
                        <div class="usage-label">Images</div>
                        <div class="usage-value" id="profileImagesUsage">- / -</div>
                        <div class="usage-bar">
                            <div class="usage-bar-fill" id="profileImagesBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="usage-item">
                        <div class="usage-label">Videos</div>
                        <div class="usage-value" id="profileVideosUsage">- / -</div>
                        <div class="usage-bar">
                            <div class="usage-bar-fill" id="profileVideosBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
                
                <button class="btn-upgrade" onclick="window.location.href='/pricing'">
                    ‚¨ÜÔ∏è Upgrade Plan
                </button>
            </div>

            <!-- Link Management -->
            <div class="link-management">
                <div class="section-header">
                    <h3 class="chart-title">üìÅ Your Events</h3>
                    <button class="refresh-btn" onclick="loadAdminLinks()">üîÑ Refresh Links</button>
                </div>
                <div id="adminLinksList">
                    <div class="loading-spinner"></div>
                </div>
            </div>

            <!-- Time Filter -->
            <div class="time-filter">
                <button class="time-btn active" data-period="24h">Last 24h</button>
                <button class="time-btn" data-period="7d">Last 7 days</button>
                <button class="time-btn" data-period="30d">Last 30 days</button>
                <button class="time-btn" data-period="90d">Last 90 days</button>
                <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon photos">üì∏</div>
                    </div>
                    <div class="stat-value" id="photosShared">-</div>
                    <div class="stat-label">Photos Shared</div>
                    <div class="stat-change" id="photosChange">
                        <span id="photosChangeText">-</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon links">üîó</div>
                    </div>
                    <div class="stat-value" id="linksCreated">-</div>
                    <div class="stat-label">Links Created</div>
                    <div class="stat-change" id="linksChange">
                        <span id="linksChangeText">-</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon downloads">‚¨áÔ∏è</div>
                    </div>
                    <div class="stat-value" id="totalDownloads">-</div>
                    <div class="stat-label">Total Downloads</div>
                    <div class="stat-change" id="downloadsChange">
                        <span id="downloadsChangeText">-</span>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon views">üëÅÔ∏è</div>
                    </div>
                    <div class="stat-value" id="totalViews">-</div>
                    <div class="stat-label">Total Views</div>
                    <div class="stat-change" id="viewsChange">
                        <span id="viewsChangeText">-</span>
                    </div>
                </div>
            </div>

            <!-- Charts Grid -->
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Activity Over Time</h3>
                    <div class="chart-canvas">
                        <canvas id="activityChart"></canvas>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">Share Sources</h3>
                    <div class="chart-canvas">
                        <canvas id="sourcesChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h3 class="chart-title">Recent Activity</h3>
                <div id="recentActivityList">
                    <div class="loading-spinner"></div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About CloudFace AI</h3>
                    <p>We create AI-powered face recognition technology that helps you discover and organize photos across your digital life. Our focus is on privacy, performance, and beautiful user experience.</p>
                    <div class="social-links">
                         <a href="#" class="social-link" aria-label="Follow @whoisvinodkumar on Twitter">
                            <svg viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                         <a href="#" class="social-link" aria-label="Follow @whoisvinodkumar on Instagram">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                         <a href="#" class="social-link" aria-label="Subscribe to @whoisvinodkumar on YouTube">
                            <svg viewBox="0 0 24 24">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </a>
                         <a href="#" class="social-link" aria-label="Connect with @whoisvinodkumar on LinkedIn">
                            <svg viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="#features">Features</a></li>
                        <!-- How It Works removed from app page -->
                        <li><a href="#privacy">Privacy</a></li>
                                                 <li><a href="/#features">Pricing</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/app">Try App</a></li>
                        <li><a href="/contact">Contact Us</a></li>
                    </ul>
                </div>
                
                                 <div class="footer-section">
                     <h3>Services</h3>
                     <ul>
                         <li><a href="/#features">Face Recognition</a></li>
                         <li><a href="/#features">Photo Organization</a></li>
                         <li><a href="/#features">Google Drive Integration</a></li>
                         <li><a href="/#features">AI Processing</a></li>
                         <li><a href="/contact">Support</a></li>
                     </ul>
                 </div>
                
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        E-2/22, Block E2, <br>DLF Phase 1, Sector 26A,<br>Gurugram, Haryana<br>122003
                    </p>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                        </svg>
                        +91 9718686723
                    </p>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                        support@cloudface-ai.com
                    </p>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                            <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                        </svg>
                        Mon-Fri: 10:00 AM-5:30 PM
                    </p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <div class="footer-left">
                        <p>&copy; 2025 cloudface-ai.com. All rights reserved.</p>
                        <p>A product of Elephic Technologies</p>
                        <p>Made with <span class="heart">‚ù§</span> in Gurugram, India</p>
                    </div>
                    <div class="footer-links">
                        <a href="/privacy">Privacy Policy</a>
                        <a href="/terms">Terms & Conditions</a>
                        <a href="/pricing">Pricing</a>
                        <a href="/refund">Refund Policy</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        function toggleNav() {
            const nav = document.getElementById('navMenu');
            if (nav) nav.classList.toggle('active');
        }

        let activityChart, sourcesChart;
        let currentPeriod = '24h';

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            loadDashboardData();
            
            // Set up time filter buttons
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    loadDashboardData();
                });
            });
        });

        function initializeCharts() {
            // Activity Chart
            const activityCtx = document.getElementById('activityChart').getContext('2d');
            activityChart = new Chart(activityCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Photos Processed',
                        data: [],
                        borderColor: '#1a73e8',
                        backgroundColor: 'rgba(26, 115, 232, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Links Created',
                        data: [],
                        borderColor: '#34a853',
                        backgroundColor: 'rgba(52, 168, 83, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#e8eaed'
                            }
                        },
                        x: {
                            grid: {
                                color: '#e8eaed'
                            }
                        }
                    }
                }
            });

            // Sources Chart
            const sourcesCtx = document.getElementById('sourcesChart').getContext('2d');
            sourcesChart = new Chart(sourcesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['WhatsApp', 'Email', 'QR Download', 'Other'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#25d366',
                            '#ea4335',
                            '#1a73e8',
                            '#9aa0a6'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        async function loadDashboardData() {
            try {
                // Show loading state
                document.getElementById('recentActivityList').innerHTML = '<div class="loading-spinner"></div>';
                
                const response = await fetch('/api/admin/dashboard');
                const data = await response.json();
                
                if (data.success) {
                    updateProfile(data.profile);
                    updateStats(data.stats);
                    updateCharts(data.charts);
                    updateRecentActivity(data.recent_activity);
                } else {
                    showError('Failed to load dashboard data: ' + data.error);
                }
            } catch (error) {
                showError('Error loading dashboard: ' + error.message);
            }
        }

        function updateStats(stats) {
            // Update main stats
            document.getElementById('photosShared').textContent = formatNumber(stats.photos_shared);
            document.getElementById('linksCreated').textContent = formatNumber(stats.links_created);
            document.getElementById('totalDownloads').textContent = formatNumber(stats.total_downloads);
            document.getElementById('totalViews').textContent = formatNumber(stats.total_views);

            // Update weekly changes
            updateChange('photosChange', stats.photos_this_week, 'photos');
            updateChange('linksChange', stats.links_this_week, 'links');
            updateChange('downloadsChange', stats.downloads_this_week, 'downloads');
            updateChange('viewsChange', stats.views_this_week, 'views');
        }

        function updateProfile(profile) {
            // Update user name and plan badge
            document.getElementById('profileUserName').textContent = profile.user_id || 'Guest User';
            document.getElementById('profilePlanBadge').textContent = profile.plan_name || 'Starter';
            
            // Update images usage
            document.getElementById('profileImagesUsage').textContent = 
                `${formatNumber(profile.images_used)} / ${formatNumber(profile.images_limit)}`;
            document.getElementById('profileImagesBar').style.width = profile.images_percentage + '%';
            
            // Update videos usage
            document.getElementById('profileVideosUsage').textContent = 
                `${formatNumber(profile.videos_used)} / ${formatNumber(profile.videos_limit)}`;
            document.getElementById('profileVideosBar').style.width = profile.videos_percentage + '%';
            
            // Hide upgrade button for enterprise plan
            const upgradeBtn = document.querySelector('.btn-upgrade');
            if (profile.plan_type === 'enterprise') {
                upgradeBtn.style.display = 'none';
            } else {
                upgradeBtn.style.display = 'block';
            }
        }

        function updateChange(elementId, weeklyValue, type) {
            const element = document.getElementById(elementId);
            const textElement = document.getElementById(elementId + 'Text');
            
            if (weeklyValue > 0) {
                element.className = 'stat-change positive';
                textElement.textContent = `+${weeklyValue} this week`;
            } else if (weeklyValue < 0) {
                element.className = 'stat-change negative';
                textElement.textContent = `${weeklyValue} this week`;
            } else {
                element.className = 'stat-change neutral';
                textElement.textContent = 'No change this week';
            }
        }

        function updateCharts(charts) {
            // Update activity chart
            activityChart.data.labels = charts.activity_labels;
            activityChart.data.datasets[0].data = charts.photos_data;
            activityChart.data.datasets[1].data = charts.links_data;
            activityChart.update();

            // Update sources chart
            sourcesChart.data.datasets[0].data = charts.sources_data;
            sourcesChart.update();
        }

        function updateRecentActivity(activities) {
            const container = document.getElementById('recentActivityList');
            
            if (activities.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üì≠</div>
                        <p>No recent activity</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon ${getActivityIconClass(activity.type)}">
                        ${getActivityIcon(activity.type)}
                    </div>
                    <div class="activity-content">
                        <div class="activity-description">${activity.description}</div>
                        <div class="activity-time">${formatTime(activity.timestamp)}</div>
                    </div>
                </div>
            `).join('');
        }

        function getActivityIconClass(type) {
            if (type.includes('photo')) return 'photos';
            if (type.includes('link')) return 'links';
            if (type.includes('download')) return 'downloads';
            if (type.includes('view')) return 'views';
            return 'photos';
        }

        function getActivityIcon(type) {
            if (type.includes('photo')) return 'üì∏';
            if (type.includes('link')) return 'üîó';
            if (type.includes('download')) return '‚¨áÔ∏è';
            if (type.includes('view')) return 'üëÅÔ∏è';
            return 'üìä';
        }

        function formatNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            return Math.floor(diff / 86400000) + 'd ago';
        }

        function showError(message) {
            document.getElementById('recentActivityList').innerHTML = `
                <div class="error-message">${message}</div>
            `;
        }

        function refreshData() {
            loadDashboardData();
            loadAdminLinks();
        }

        // Load admin links
        async function loadAdminLinks() {
            try {
                const response = await fetch('/api/get-admin-links');
                const data = await response.json();
                
                if (data.success) {
                    displayAdminLinks(data.links);
                } else {
                    document.getElementById('adminLinksList').innerHTML = `
                        <div class="error-message">Failed to load links: ${data.error}</div>
                    `;
                }
            } catch (error) {
                document.getElementById('adminLinksList').innerHTML = `
                    <div class="error-message">Error loading links: ${error.message}</div>
                `;
            }
        }

        function displayAdminLinks(links) {
            const container = document.getElementById('adminLinksList');
            
            if (links.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <div style="font-size: 3rem; margin-bottom: 1rem;">üîó</div>
                        <h4>No shared links yet</h4>
                        <p>Create your first shareable link using the <a href="/admin/link-generator" style="color: var(--primary);">Link Generator</a></p>
                    </div>
                `;
                return;
            }

            container.innerHTML = links.map(link => `
                <div class="link-item">
                    <div class="link-header">
                        <div>
                            <div class="link-title">${link.metadata.event_name || 'Untitled Event'}</div>
                            <div class="link-meta">
                                ${link.metadata.company_name || 'No Company'} ‚Ä¢ 
                                Created ${formatTime(link.created_at)}
                                ${link.last_used ? ` ‚Ä¢ Last used ${formatTime(link.last_used)}` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="event-preview">
                        ${link.session_id ? `
                            <img class="preview-draggable" data-link-id="${link.id || ''}" data-pos-y="${(link.metadata && link.metadata.preview_position_y !== undefined) ? link.metadata.preview_position_y : 50}" style="object-position: 50% ${((link.metadata && link.metadata.preview_position_y !== undefined) ? link.metadata.preview_position_y : 50)}%;" src="/api/admin/event-preview-image/${encodeURIComponent(link.session_id)}" alt="Event preview" draggable="false" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'; this.nextElementSibling.nextElementSibling.style.display='none';">
                            <div class="event-preview-empty" style="display:none;">No preview image yet</div>
                            <div class="preview-drag-hint">Drag to adjust</div>
                        ` : `
                            <div class="event-preview-empty">No preview image yet</div>
                        `}
                    </div>
                    
                    ${link.downloaders && link.downloaders.length > 0 ? `
                    <div class="downloaders-section" style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-weight: 600; margin-bottom: 0.5rem; color: var(--text-primary);">Who Downloaded (${link.downloaders.length} users):</div>
                        ${link.downloaders.map(downloader => `
                            <div style="background: rgba(255,255,255,0.1); padding: 0.5rem; border-radius: 4px; margin-bottom: 0.5rem;">
                                <div style="font-weight: 500;">${downloader.user_id}</div>
                                <div style="font-size: 0.85rem; opacity: 0.9;">${downloader.download_count} photo(s) ‚Ä¢ Last: ${formatTime(downloader.last_download)}</div>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                    
                    <div class="link-actions">
                        <button class="btn-small btn-danger" onclick="deleteEvent('${link.id}', '${link.short_code}', '${link.metadata.event_name || 'Event'}')">
                            üóëÔ∏è Delete
                        </button>
                        <button class="btn-small btn-add-photos" onclick="addMorePhotos(this, '${link.id || ''}', '${(link.metadata.drive_url || '').replace(/'/g, "\\'")}', '${(link.session_id || '').replace(/'/g, "\\'")}', '${(link.metadata.event_name || 'Event').replace(/'/g, '\\\'')}', '${(link.full_url || '').replace(/'/g, "\\'")}', '${(link.short_code || '').replace(/'/g, "\\'")}')">
                            ‚ûï Add Photos
                        </button>
                        <button class="btn-small" onclick="viewEventPhotos('${(link.session_id || '').replace(/'/g, "\\'")}')">
                            üñºÔ∏è Event Photos
                        </button>
                        <button class="btn-small" onclick="openEditEventModal('${link.id}', '${(link.short_code || '').replace(/'/g, "\\'")}', '${(link.session_id || '').replace(/'/g, "\\'")}', '${(link.metadata.event_name || '').replace(/'/g, "\\'")}', '${(link.metadata.company_name || '').replace(/'/g, "\\'")}', '${(link.metadata.event_date || '').replace(/'/g, "\\'")}', '${(link.metadata.watermark_enabled !== undefined ? String(link.metadata.watermark_enabled) : 'true').replace(/'/g, "\\'")}', '${(link.metadata.watermark_text || '').replace(/'/g, "\\'")}', '${(link.metadata.watermark_logo_filename || '').replace(/'/g, "\\'")}', '${(link.metadata.watermark_position || 'bottom-right').replace(/'/g, "\\'")}', '${(link.metadata.watermark_opacity !== undefined ? String(link.metadata.watermark_opacity) : '70').replace(/'/g, "\\'")}', '${(link.metadata.watermark_size !== undefined ? String(link.metadata.watermark_size) : '15').replace(/'/g, "\\'")}', '${(link.metadata.watermark_margin !== undefined ? String(link.metadata.watermark_margin) : '12').replace(/'/g, "\\'")}')">
                            ‚úèÔ∏è Edit Details
                        </button>
                        <button class="btn-small" onclick="savePreviewPosition('${link.id}', this)">
                            üíæ Save Preview
                        </button>
                    </div>
                    <div class="link-actions">
                        <button class="btn-small btn-copy" onclick="copyLink('${link.short_url}', this)">
                            üìã Copy Link
                        </button>
                        <button class="btn-small" onclick="openLink('${link.short_url}')">
                            üîó Open Link
                        </button>
                        <button class="btn-small" onclick="shareLink('${link.short_url}', '${link.metadata.event_name || 'Event'}')">
                            üì§ Share
                        </button>
                        <button class="btn-small" onclick="openWhatsAppShare('${(link.short_url || '').replace(/'/g, "\\'")}', '${(link.metadata.event_name || 'Event').replace(/'/g, "\\'")}')">
                            üí¨ WhatsApp
                        </button>
                        <button class="btn-small" onclick="openEmailShare('${(link.short_url || '').replace(/'/g, "\\'")}', '${(link.metadata.event_name || 'Event').replace(/'/g, "\\'")}')">
                            üìß Email
                        </button>
                        <button class="btn-small" onclick="openEventShareModal('${(link.short_url || '').replace(/'/g, "\\'")}', '${(link.metadata.event_name || 'Event').replace(/'/g, "\\'")}', '${(link.metadata.event_date || '').replace(/'/g, "\\'")}', '${(link.metadata.company_name || '').replace(/'/g, "\\'")}')">
                            üì± QR
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function copyLink(url, buttonElement) {
            navigator.clipboard.writeText(url).then(() => {
                if (buttonElement) {
                    const originalText = buttonElement.textContent;
                    buttonElement.textContent = '‚úÖ Copied!';
                    buttonElement.style.background = '#28a745';
                    setTimeout(() => {
                        buttonElement.textContent = originalText;
                        buttonElement.style.background = '';
                    }, 2000);
                }
            }).catch(err => {
                alert('Failed to copy: ' + err);
            });
        }

        function openLink(url) {
            window.open(url, '_blank');
        }

        function shareLink(url, eventName) {
            const shareText = `Check out photos from ${eventName}: ${url}`;
            
            if (navigator.share) {
                navigator.share({
                    title: eventName,
                    text: shareText,
                    url: url
                });
            } else {
                // Fallback to copying to clipboard
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Share text copied to clipboard!');
                });
            }
        }

        function openWhatsAppShare(url, eventName) {
            const msg = `Check out photos from ${eventName}: ${url}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
        }

        function openEmailShare(url, eventName) {
            const subject = `Photos from ${eventName}`;
            const body = `Hi,\n\nHere is the photo link for ${eventName}:\n${url}\n\nRegards`;
            window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        }

        function getQrImageUrl(url) {
            return `https://api.qrserver.com/v1/create-qr-code/?size=420x420&data=${encodeURIComponent(url)}`;
        }

        function openEventShareModal(url, eventName, eventDate, companyName) {
            const modal = document.getElementById('eventShareModal');
            document.getElementById('eventShareTitle').textContent = eventName || 'Event';
            document.getElementById('eventShareLink').textContent = url;
            document.getElementById('eventShareQrImg').src = getQrImageUrl(url);
            document.getElementById('eventShareQrImg').alt = `QR for ${eventName || 'Event'}`;
            modal.classList.add('show');
            modal.setAttribute('data-url', url);
            modal.setAttribute('data-name', eventName || 'Event');
            modal.setAttribute('data-date', eventDate || '');
            modal.setAttribute('data-company', companyName || '');
        }

        function closeEventShareModal() {
            const modal = document.getElementById('eventShareModal');
            modal.classList.remove('show');
        }

        function copyEventShareLink() {
            const modal = document.getElementById('eventShareModal');
            const url = modal.getAttribute('data-url') || '';
            if (!url) return;
            navigator.clipboard.writeText(url).then(() => alert('Link copied'));
        }

        function shareEventWhatsApp() {
            const modal = document.getElementById('eventShareModal');
            openWhatsAppShare(modal.getAttribute('data-url') || '', modal.getAttribute('data-name') || 'Event');
        }

        function shareEventEmail() {
            const modal = document.getElementById('eventShareModal');
            openEmailShare(modal.getAttribute('data-url') || '', modal.getAttribute('data-name') || 'Event');
        }

        function loadImageAsDataUrl(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    try {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.naturalWidth || img.width;
                        canvas.height = img.naturalHeight || img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        resolve(canvas.toDataURL('image/png'));
                    } catch (e) {
                        reject(e);
                    }
                };
                img.onerror = reject;
                img.src = url;
            });
        }

        async function downloadEventQr() {
            const modal = document.getElementById('eventShareModal');
            const url = modal.getAttribute('data-url') || '';
            if (!url) return;

            const rawEventName = modal.getAttribute('data-name') || 'Event';
            const eventDate = (modal.getAttribute('data-date') || '').trim();
            const companyName = (modal.getAttribute('data-company') || '').trim();
            const safeEventName = rawEventName.replace(/[^a-zA-Z0-9_-]/g, '-') || 'event';

            if (!window.jspdf || !window.jspdf.jsPDF) {
                alert('PDF library failed to load. Please refresh and try again.');
                return;
            }

            try {
                const qrDataUrl = await loadImageAsDataUrl(getQrImageUrl(url));
                let logoDataUrl = '';
                try {
                    logoDataUrl = await loadImageAsDataUrl('/static/Cloudface-ai-logo.png');
                } catch (e) {
                    logoDataUrl = '';
                }

                const width = 2000;
                const height = 2700;
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                // Poster background + border
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, width, height);
                roundedRect(26, 26, width - 52, height - 52, 48);
                ctx.strokeStyle = '#1f1f1f';
                ctx.lineWidth = 3;
                ctx.stroke();

                function roundedRect(x, y, w, h, r) {
                    ctx.beginPath();
                    ctx.moveTo(x + r, y);
                    ctx.lineTo(x + w - r, y);
                    ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                    ctx.lineTo(x + w, y + h - r);
                    ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                    ctx.lineTo(x + r, y + h);
                    ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                    ctx.lineTo(x, y + r);
                    ctx.quadraticCurveTo(x, y, x + r, y);
                    ctx.closePath();
                }

                function fitCenterTextSerif(textValue, y, maxWidth, startSize, minSize, weight, color) {
                    let fontSize = startSize;
                    ctx.fillStyle = color;
                    while (fontSize > minSize) {
                        ctx.font = `${weight} ${fontSize}px "Times New Roman", Georgia, serif`;
                        if (ctx.measureText(textValue).width <= maxWidth) break;
                        fontSize -= 2;
                    }
                    ctx.fillText(textValue, width / 2, y);
                }

                // Helpers for cleaner poster alignment
                function fitCenterText(textValue, y, maxWidth, startSize, minSize, weight, color) {
                    let fontSize = startSize;
                    ctx.fillStyle = color;
                    while (fontSize > minSize) {
                        ctx.font = `${weight} ${fontSize}px Arial, sans-serif`;
                        if (ctx.measureText(textValue).width <= maxWidth) break;
                        fontSize -= 4;
                    }
                    ctx.fillText(textValue, width / 2, y);
                }

                // Top company
                ctx.textAlign = 'center';
                fitCenterTextSerif(companyName || 'COMPANY NAME', 300, 1450, 74, 42, 500, '#111111');

                // Blue event-name pill
                const pillX = 380;
                const pillY = 360;
                const pillW = 1240;
                const pillH = 128;
                roundedRect(pillX, pillY, pillW, pillH, 58);
                ctx.fillStyle = '#2b76d6';
                ctx.fill();

                fitCenterTextSerif(rawEventName || 'EVENT NAME', 446, 1080, 72, 40, 700, '#ffffff');
                fitCenterTextSerif(eventDate || 'EVENT DATE', 575, 1200, 66, 36, 500, '#111111');
                fitCenterTextSerif('SCAN ME', 800, 900, 72, 44, 600, '#111111');

                // QR in center
                const qrImage = new Image();
                await new Promise((resolve, reject) => {
                    qrImage.onload = resolve;
                    qrImage.onerror = reject;
                    qrImage.src = qrDataUrl;
                });
                const qrSize = 1120;
                const qrX = Math.round((width - qrSize) / 2);
                const qrY = 900;

                // QR frame
                const qrFramePad = 34;
                roundedRect(qrX - qrFramePad, qrY - qrFramePad, qrSize + (qrFramePad * 2), qrSize + (qrFramePad * 2), 18);
                ctx.fillStyle = '#ffffff';
                ctx.fill();
                ctx.strokeStyle = '#c8cfd8';
                ctx.lineWidth = 4;
                ctx.stroke();

                ctx.drawImage(qrImage, qrX, qrY, qrSize, qrSize);

                // Instruction under QR
                fitCenterTextSerif('TO FIND YOURSELF', 2190, 1200, 72, 40, 600, '#111111');

                // App logo at bottom
                let logoBottomY = 2470;
                if (logoDataUrl) {
                    const logoImg = new Image();
                    await new Promise((resolve, reject) => {
                        logoImg.onload = resolve;
                        logoImg.onerror = reject;
                        logoImg.src = logoDataUrl;
                    });
                    const maxW = 120;
                    const ratio = logoImg.width > 0 ? (logoImg.height / logoImg.width) : 0.35;
                    const logoW = maxW;
                    const logoH = Math.max(24, Math.round(maxW * ratio));
                    const logoX = Math.round((width - logoW) / 2);
                    const logoY = 2480;
                    ctx.drawImage(logoImg, logoX, logoY, logoW, logoH);
                    logoBottomY = logoY + logoH;
                }

                // Bottom divider lines
                ctx.strokeStyle = '#222222';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(120, 2570);
                ctx.lineTo(700, 2570);
                ctx.moveTo(1300, 2570);
                ctx.lineTo(1880, 2570);
                ctx.stroke();

                // Footer brand line under logo (small)
                ctx.fillStyle = '#444b55';
                ctx.font = '400 30px Arial, sans-serif';
                ctx.fillText('A product of Elephic Technologies', width / 2, logoBottomY + 56);

                const pdf = new window.jspdf.jsPDF({
                    orientation: 'portrait',
                    unit: 'px',
                    format: [width, height]
                });
                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, width, height, undefined, 'FAST');
                pdf.save(`${safeEventName}-qr.pdf`);
            } catch (error) {
                console.error('QR PDF generation failed:', error);
                alert('Failed to download QR PDF. Please try again.');
            }
        }

        async function addMorePhotos(btn, linkId, driveUrl, sessionId, eventName, fullUrl, shortCode) {
            let sid = (sessionId && sessionId.trim()) || null;
            if (!sid && fullUrl) {
                try { sid = new URL(fullUrl).searchParams.get('session'); } catch (e) {}
            }
            if (!sid && (shortCode || fullUrl)) {
                try {
                    const q = new URLSearchParams();
                    if (shortCode) q.set('short_code', shortCode);
                    if (fullUrl) q.set('full_url', fullUrl);
                    const r = await fetch('/api/admin/resolve-session-id?' + q.toString());
                    const d = await r.json();
                    if (d.success && d.session_id) sid = d.session_id;
                } catch (e) {}
            }
            if (sid) {
                window.location.href = '/admin/event-add-photos/' + encodeURIComponent(sid);
                return;
            }
            if (linkId) {
                // Fallback only when session_id could not be resolved client-side.
                window.location.href = '/admin/event-add-photos-link/' + encodeURIComponent(linkId);
            } else {
                alert('This event could not be identified. Refresh the dashboard and try again, or add photos from the App page for a new event.');
            }
        }

        function viewEventPhotos(sessionId) {
            if (!sessionId) {
                alert('Event session ID not available.');
                return;
            }
            window.open(`/admin/event-photos/${encodeURIComponent(sessionId)}`, '_blank');
        }

        function initPreviewDragBehavior() {
            const container = document.getElementById('adminLinksList');
            if (!container || container.dataset.dragInit === '1') return;
            container.dataset.dragInit = '1';

            let activeImg = null;
            let startY = 0;
            let startPosY = 50;

            function getPosY(img) {
                const parts = (img.style.objectPosition || '50% 50%').split(' ');
                const y = (parts[1] || '50%').replace('%', '');
                const parsed = parseFloat(y);
                return Number.isNaN(parsed) ? 50 : parsed;
            }

            function endDrag() {
                if (!activeImg) return;
                activeImg.classList.remove('dragging');
                activeImg = null;
            }

            container.addEventListener('mousedown', function(e) {
                const img = e.target.closest('.preview-draggable');
                if (!img) return;
                e.preventDefault();
                activeImg = img;
                activeImg.classList.add('dragging');
                startY = e.clientY;
                startPosY = getPosY(img);
            });

            window.addEventListener('mousemove', function(e) {
                if (!activeImg) return;
                const delta = e.clientY - startY;
                const next = Math.max(0, Math.min(100, startPosY + (delta / 2)));
                activeImg.style.objectPosition = `50% ${next}%`;
                activeImg.dataset.posY = String(next);
            });

            window.addEventListener('mouseup', endDrag);
            window.addEventListener('mouseleave', endDrag);
        }

        async function savePreviewPosition(linkId, buttonElement) {
            if (!linkId) return;
            const img = document.querySelector(`.preview-draggable[data-link-id="${linkId}"]`);
            if (!img) return;
            const posY = parseFloat(img.dataset.posY || '50');
            const originalText = buttonElement ? buttonElement.textContent : '';
            try {
                if (buttonElement) {
                    buttonElement.disabled = true;
                    buttonElement.textContent = 'Saving...';
                }
                const response = await fetch('/api/update-admin-link', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: Number(linkId) || null,
                        metadata: { preview_position_y: posY }
                    })
                });
                const data = await response.json();
                if (!data.success) {
                    alert(data.error || 'Failed to save preview position');
                    return;
                }
                if (buttonElement) {
                    buttonElement.textContent = '‚úÖ Saved';
                    setTimeout(() => {
                        buttonElement.textContent = originalText || 'üíæ Save Preview';
                        buttonElement.disabled = false;
                    }, 900);
                }
            } catch (error) {
                alert('Failed to save preview position');
            } finally {
                if (buttonElement && buttonElement.textContent !== '‚úÖ Saved') {
                    buttonElement.textContent = originalText || 'üíæ Save Preview';
                    buttonElement.disabled = false;
                }
            }
        }

        async function deleteEvent(linkId, shortCode, eventName) {
            const confirmText = `Delete event "${eventName}"? This removes the share link and cannot be undone.`;
            if (!confirm(confirmText)) {
                return;
            }

            try {
                const response = await fetch('/api/delete-admin-link', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: Number(linkId) || null,
                        short_code: shortCode || null
                    })
                });
                const data = await response.json();
                if (!data.success) {
                    alert(data.error || 'Delete failed');
                    return;
                }
                loadAdminLinks();
            } catch (error) {
                alert('Delete failed');
            }
        }

        function openEditEventModal(linkId, shortCode, sessionId, eventName, companyName, eventDate, wmEnabled, wmText, wmLogoFilename, wmPosition, wmOpacity, wmSize, wmMargin) {
            const modal = document.getElementById('editEventModal');
            modal.setAttribute('data-link-id', linkId || '');
            modal.setAttribute('data-short-code', shortCode || '');
            modal.setAttribute('data-session-id', sessionId || '');
            document.getElementById('editEventName').value = eventName || '';
            document.getElementById('editCompanyName').value = companyName || '';
            document.getElementById('editEventDate').value = eventDate || '';
            document.getElementById('editWatermarkEnabled').checked = String(wmEnabled || 'true') !== 'false';
            document.getElementById('editWatermarkText').value = wmText || '';
            document.getElementById('editWatermarkPosition').value = wmPosition || 'bottom-right';
            document.getElementById('editWatermarkOpacity').value = Number(wmOpacity || 70);
            document.getElementById('editWatermarkSize').value = Number(wmSize || 15);
            document.getElementById('editWatermarkMargin').value = Number(wmMargin || 12);
            document.getElementById('editWatermarkLogoFilename').value = wmLogoFilename || '';
            const logoPreview = document.getElementById('editWatermarkLogoPreview');
            const logoImg = document.getElementById('editWatermarkLogoPreviewImg');
            if (wmLogoFilename) {
                logoImg.src = `/static/logos/${wmLogoFilename}`;
                logoPreview.style.display = 'block';
            } else {
                logoPreview.style.display = 'none';
            }
            const previewImg = document.getElementById('editWatermarkPreviewImage');
            if (sessionId) {
                previewImg.src = `/api/admin/event-preview-image/${encodeURIComponent(sessionId)}`;
            } else {
                previewImg.src = '';
            }
            updateEditWatermarkPreview();
            document.getElementById('editEventError').textContent = '';
            modal.classList.add('show');
        }

        function closeEditEventModal() {
            const modal = document.getElementById('editEventModal');
            modal.classList.remove('show');
        }

        async function saveEditEventDetails() {
            const modal = document.getElementById('editEventModal');
            const payload = {
                id: Number(modal.getAttribute('data-link-id')) || null,
                short_code: modal.getAttribute('data-short-code') || null,
                metadata: {
                    event_name: document.getElementById('editEventName').value || '',
                    company_name: document.getElementById('editCompanyName').value || '',
                    event_date: document.getElementById('editEventDate').value || '',
                    watermark_enabled: document.getElementById('editWatermarkEnabled').checked,
                    watermark_text: document.getElementById('editWatermarkText').value || '',
                    watermark_logo_filename: document.getElementById('editWatermarkLogoFilename').value || '',
                    watermark_position: document.getElementById('editWatermarkPosition').value || 'bottom-right',
                    watermark_opacity: Number(document.getElementById('editWatermarkOpacity').value || 70),
                    watermark_size: Number(document.getElementById('editWatermarkSize').value || 15),
                    watermark_margin: Number(document.getElementById('editWatermarkMargin').value || 12)
                }
            };
            try {
                const response = await fetch('/api/update-admin-link', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if (!data.success) {
                    document.getElementById('editEventError').textContent = data.error || 'Update failed';
                    return;
                }
                closeEditEventModal();
                loadAdminLinks();
            } catch (error) {
                document.getElementById('editEventError').textContent = 'Update failed';
            }
        }

        async function handleEditWatermarkLogoUpload(event) {
            const file = event.target.files && event.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            const formData = new FormData();
            formData.append('logo', file);
            try {
                const response = await fetch('/upload-logo', { method: 'POST', body: formData });
                const data = await response.json();
                if (!data.success) {
                    alert(data.error || 'Failed to upload logo');
                    return;
                }
                document.getElementById('editWatermarkLogoFilename').value = data.filename;
                const logoPreview = document.getElementById('editWatermarkLogoPreview');
                const logoImg = document.getElementById('editWatermarkLogoPreviewImg');
                logoImg.src = `/static/logos/${data.filename}`;
                logoPreview.style.display = 'block';
                updateEditWatermarkPreview();
            } catch (e) {
                alert('Failed to upload logo');
            }
        }

        function removeEditWatermarkLogo() {
            document.getElementById('editWatermarkLogo').value = '';
            document.getElementById('editWatermarkLogoFilename').value = '';
            document.getElementById('editWatermarkLogoPreview').style.display = 'none';
            updateEditWatermarkPreview();
        }

        function updateEditWatermarkPreview() {
            const enabled = document.getElementById('editWatermarkEnabled').checked;
            const panel = document.getElementById('editWatermarkPreviewPanel');
            const overlay = document.getElementById('editWatermarkPreviewOverlay');
            const logo = document.getElementById('editWatermarkPreviewLogo');
            const text = document.getElementById('editWatermarkPreviewText');
            const position = document.getElementById('editWatermarkPosition').value || 'bottom-right';
            const opacity = Number(document.getElementById('editWatermarkOpacity').value || 70);
            const size = Number(document.getElementById('editWatermarkSize').value || 15);
            const margin = Number(document.getElementById('editWatermarkMargin').value || 12);
            const logoFilename = document.getElementById('editWatermarkLogoFilename').value || '';
            const watermarkText = (document.getElementById('editWatermarkText').value || '').trim();

            document.getElementById('editWatermarkSizeValue').textContent = `${size}%`;
            document.getElementById('editWatermarkOpacityValue').textContent = `${opacity}%`;
            document.getElementById('editWatermarkMarginValue').textContent = `${margin}px`;

            panel.style.display = enabled ? 'block' : 'none';
            const hasContent = Boolean(logoFilename || watermarkText);
            overlay.style.display = (enabled && hasContent) ? 'inline-flex' : 'none';
            overlay.style.opacity = String(Math.max(0.2, Math.min(1, opacity / 100)));
            text.textContent = watermarkText;
            text.style.display = watermarkText ? 'inline' : 'none';
            text.style.fontSize = `${Math.max(12, Math.round(size * 0.8))}px`;

            if (logoFilename) {
                logo.src = `/static/logos/${logoFilename}`;
                logo.style.display = 'block';
                logo.style.height = `${Math.max(16, Math.round(size * 1.8))}px`;
            } else {
                logo.style.display = 'none';
            }

            overlay.style.top = '';
            overlay.style.bottom = '';
            overlay.style.left = '';
            overlay.style.right = '';
            overlay.style.transform = '';
            if (position.startsWith('top')) overlay.style.top = `${margin}px`;
            else overlay.style.bottom = `${margin}px`;
            if (position.endsWith('left')) overlay.style.left = `${margin}px`;
            else if (position.endsWith('right')) overlay.style.right = `${margin}px`;
            else {
                overlay.style.left = '50%';
                overlay.style.transform = 'translateX(-50%)';
            }
        }

        // Load admin links on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAdminLinks();
            initPreviewDragBehavior();
            const modal = document.getElementById('eventShareModal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) closeEventShareModal();
            });
            const editModal = document.getElementById('editEventModal');
            editModal.addEventListener('click', function(e) {
                if (e.target === editModal) closeEditEventModal();
            });
            ['editWatermarkEnabled', 'editWatermarkText', 'editWatermarkPosition', 'editWatermarkOpacity', 'editWatermarkSize', 'editWatermarkMargin']
                .forEach(id => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    const evt = (id === 'editWatermarkText' || id === 'editWatermarkPosition' || id === 'editWatermarkEnabled') ? 'input' : 'input';
                    el.addEventListener(evt, updateEditWatermarkPreview);
                    if (id === 'editWatermarkEnabled' || id === 'editWatermarkPosition') {
                        el.addEventListener('change', updateEditWatermarkPreview);
                    }
                });
        });

        // Auto-refresh every 5 minutes
        setInterval(loadDashboardData, 300000);
    </script>

    <div id="eventShareModal" class="share-modal" role="dialog" aria-modal="true">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h3 id="eventShareTitle">Event Share</h3>
                <button class="btn-small" onclick="closeEventShareModal()">‚úï</button>
            </div>
            <div id="eventShareLink" class="share-link-box"></div>
            <div class="share-modal-actions">
                <button class="btn-small btn-copy" onclick="copyEventShareLink()">üìã Copy Link</button>
                <button class="btn-small" onclick="shareEventWhatsApp()">üí¨ WhatsApp</button>
                <button class="btn-small" onclick="shareEventEmail()">üìß Email</button>
                <button class="btn-small" onclick="downloadEventQr()">‚¨áÔ∏è Download QR</button>
            </div>
            <div class="qr-wrap">
                <img id="eventShareQrImg" alt="Event QR" />
                <div style="margin-top:0.5rem;color:var(--text-secondary);font-size:0.9rem;">Scan to access this event photos</div>
            </div>
        </div>
    </div>
    <div id="editEventModal" class="share-modal" role="dialog" aria-modal="true">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <h3>Edit Event Details</h3>
                <button class="btn-small" onclick="closeEditEventModal()">‚úï</button>
            </div>
            <div class="edit-form-grid">
                <div>
                    <label for="editEventName">Event Name</label>
                    <input id="editEventName" type="text" placeholder="Event name">
                </div>
                <div>
                    <label for="editCompanyName">Company Name</label>
                    <input id="editCompanyName" type="text" placeholder="Company name">
                </div>
                <div>
                    <label for="editEventDate">Event Date</label>
                    <input id="editEventDate" type="text" placeholder="YYYY-MM-DD">
                </div>
                <div style="border-top:1px solid var(--border); padding-top:0.5rem;">
                    <label class="wm-toggle-label">
                        <input id="editWatermarkEnabled" type="checkbox">
                        Enable watermark for shared results
                    </label>
                </div>
                <div class="edit-watermark-wrap">
                    <div>
                        <div>
                            <label for="editWatermarkText">Watermark Text</label>
                            <input id="editWatermarkText" type="text" placeholder="Optional watermark text">
                        </div>
                        <div>
                            <label for="editWatermarkLogo">Watermark Logo</label>
                            <input id="editWatermarkLogo" type="file" accept="image/*" onchange="handleEditWatermarkLogoUpload(event)">
                            <input id="editWatermarkLogoFilename" type="hidden">
                            <div id="editWatermarkLogoPreview" style="display:none; margin-top:8px;">
                                <img id="editWatermarkLogoPreviewImg" style="max-width: 120px; max-height: 60px; border-radius: 4px; border: 1px solid var(--border);">
                                <button type="button" class="btn-small" onclick="removeEditWatermarkLogo()">Remove</button>
                            </div>
                        </div>
                        <div>
                            <label for="editWatermarkPosition">Watermark Position</label>
                            <select id="editWatermarkPosition" style="width:100%; border:1px solid var(--border); border-radius:var(--radius-sm); padding:0.6rem;">
                                <option value="top-left">Top Left</option>
                                <option value="top-center">Top Center</option>
                                <option value="top-right">Top Right</option>
                                <option value="bottom-left">Bottom Left</option>
                                <option value="bottom-center">Bottom Center</option>
                                <option value="bottom-right">Bottom Right</option>
                            </select>
                        </div>
                        <div>
                            <label for="editWatermarkSize">Watermark Size (%) <span id="editWatermarkSizeValue">15%</span></label>
                            <input id="editWatermarkSize" type="range" min="5" max="40" value="15">
                        </div>
                        <div>
                            <label for="editWatermarkOpacity">Watermark Opacity (%) <span id="editWatermarkOpacityValue">70%</span></label>
                            <input id="editWatermarkOpacity" type="range" min="20" max="100" value="70">
                        </div>
                        <div>
                            <label for="editWatermarkMargin">Watermark Margin (px) <span id="editWatermarkMarginValue">12px</span></label>
                            <input id="editWatermarkMargin" type="range" min="0" max="40" value="12">
                        </div>
                    </div>
                    <div id="editWatermarkPreviewPanel" class="edit-watermark-preview-panel">
                        <div class="edit-watermark-preview-canvas">
                            <img id="editWatermarkPreviewImage" class="base" alt="Watermark preview image">
                            <div id="editWatermarkPreviewOverlay" class="edit-watermark-overlay">
                                <img id="editWatermarkPreviewLogo" alt="Watermark logo">
                                    <span id="editWatermarkPreviewText"></span>
                            </div>
                        </div>
                        <div style="font-size:0.82rem;color:var(--text-secondary);margin-top:0.45rem;">Preview updates live</div>
                    </div>
                </div>
                <div id="editEventError" style="color:#c5221f; font-size:0.9rem;"></div>
            </div>
            <div class="share-modal-actions" style="margin-top: 1rem; margin-bottom: 0;">
                <button class="btn-small" onclick="saveEditEventDetails()">üíæ Save</button>
                <button class="btn-small" onclick="closeEditEventModal()">Cancel</button>
            </div>
        </div>
    </div>
</body>
</html>