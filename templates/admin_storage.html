<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudFace AI - Storage Cleanup</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <style>
        :root{--primary:#1a73e8;--bg:#fafafa;--surface:#fff;--text:#202124;--muted:#5f6368;--border:#dadce0;--radius:16px;--radius-sm:8px;--shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24)}
        body{font-family:'Google Sans',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);margin:0}
        .header{background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
        .header-content{max-width:1200px;margin:0 auto;padding:1rem;display:flex;justify-content:space-between;align-items:center}
        .container{max-width:1200px;margin:0 auto;padding:2rem 1rem}
        .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:1.5rem;margin-bottom:1.5rem}
        h1{font-size:1.8rem;margin:0}
        h2{font-size:1.3rem;margin:0 0 0.75rem 0}
        .muted{color:var(--muted);font-size:0.95rem}
        table{width:100%;border-collapse:collapse;margin-top:1rem}
        th,td{text-align:left;padding:0.6rem;border-bottom:1px solid var(--border);font-size:0.95rem}
        th{color:var(--muted);font-weight:600}
        .badge{display:inline-block;background:#e8f0fe;color:#1a73e8;font-weight:600;font-size:0.75rem;padding:0.2rem 0.5rem;border-radius:999px}
        .btn{background:#1a73e8;color:#fff;border:none;padding:0.45rem 0.75rem;border-radius:8px;cursor:pointer}
        .btn-danger{background:#d93025}
        .btn:disabled{opacity:0.5;cursor:not-allowed}
        .row-actions{display:flex;gap:0.5rem;align-items:center}
        .empty{padding:0.75rem 0;color:var(--muted)}
        @media (max-width: 768px){
            table, thead, tbody, th, td, tr { display: block; }
            thead { display: none; }
            tr { margin-bottom: 1rem; border: 1px solid var(--border); border-radius: 12px; padding: 0.6rem; background: #fff; }
            td { border: none; padding: 0.3rem 0; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1>Storage Cleanup</h1>
            <a href="/admin/dashboard" class="btn">Back to Dashboard</a>
        </div>
    </header>

    <div class="container">
        <div class="card">
            <p class="muted">
                Review items stored on the server and delete test data manually.
                This action is permanent. Use with care.
            </p>
        </div>

        {% for key, section in storage_data.items() %}
        <div class="card">
            <h2>{{ key|capitalize }} <span class="badge">{{ section.entries|length }} items</span></h2>
            <p class="muted">{{ section.root }}</p>

            {% if section.entries %}
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Modified</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entry in section.entries %}
                    <tr>
                        <td>{{ entry.name }}</td>
                        <td>{{ 'Folder' if entry.is_dir else 'File' }}</td>
                        <td>{{ entry.size }}</td>
                        <td>{{ entry.modified }}</td>
                        <td>
                            <div class="row-actions">
                                <button class="btn btn-danger" onclick="deletePath('{{ entry.path }}', this)">Delete</button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="empty">No files found.</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <script>
        async function deletePath(path, button) {
            if (!confirm(`Delete ${path}? This cannot be undone.`)) {
                return;
            }
            button.disabled = true;
            try {
                const response = await fetch('/api/admin/storage/delete', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path })
                });
                const result = await response.json();
                if (!result.success) {
                    alert(result.error || 'Delete failed');
                    button.disabled = false;
                    return;
                }
                location.reload();
            } catch (error) {
                alert('Delete failed');
                button.disabled = false;
            }
        }
    </script>
</body>
</html>
