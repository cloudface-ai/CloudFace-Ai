<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Watermark - Image Tools</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --primary: #1a73e8;
            --primary-light: #4285f4;
            --primary-dark: #0d47a1;
            --accent: #ea4335;
            --accent-light: #f28b82;
            --success: #34a853;
            --warning: #fbbc04;
            --bg: #fafafa;
            --surface: #ffffff;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-tertiary: #9aa0a6;
            --border: #dadce0;
            --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-hover: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
            --radius: 16px;
            --radius-sm: 8px;
            --transition: none;
        }
        body {
            font-family: 'Google Sans', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
        }
        .header-top {
            background: var(--primary);
            color: #fff;
            padding: 4px 0;
            font-size: 12px;
            text-align: center;
        }
        .header-main { padding: 1px 0; }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .logo {
            font-size: 18px;
            font-weight: 500;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .nav-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            cursor: pointer;
            padding: 4px;
            border-radius: var(--radius-sm);
            transition: var(--transition);
            display: none;
            align-items: center;
            justify-content: center;
        }
        .nav-toggle svg { width: 24px; height: 24px; fill: currentColor; }
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
            list-style: none;
        }
        .nav-menu a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
        }
        .nav-menu a:hover {
            color: var(--primary);
            background: var(--bg);
        }
        .nav-menu a.active {
            color: var(--primary);
            background: var(--bg);
        }
        .cta-button {
            background: var(--primary);
            color: #fff;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.1s ease;
        }
        .cta-button:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }
        .tool-container {
            max-width: 860px;
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 28px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            margin: 2rem auto;
        }
        h1 { font-size: 24px; margin-bottom: 6px; }
        .subtitle { color: var(--text-secondary); margin-bottom: 20px; font-size: 14px; }
        .grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 14px;
        }
        .full { grid-column: 1 / -1; }
        label { font-size: 13px; font-weight: 600; margin-bottom: 6px; display: block; }
        input[type="text"], input[type="file"], select, input[type="range"] {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font: inherit;
        }
        .hint { font-size: 12px; color: var(--text-secondary); margin-top: 6px; }
        .btn {
            padding: 12px 16px;
            border: 0;
            border-radius: 10px;
            background: var(--primary);
            color: #fff;
            font-weight: 600;
            cursor: pointer;
        }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .row { display: flex; gap: 12px; align-items: center; }
        .preview {
            margin-top: 18px;
            padding: 12px;
            border: 1px dashed var(--border);
            border-radius: 10px;
            background: #f7f9fc;
        }
        .drop-overlay {
            position: fixed;
            inset: 0;
            background: rgba(26, 115, 232, 0.12);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .drop-card {
            background: var(--surface);
            border: 2px dashed var(--primary);
            padding: 24px 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.18);
        }
        .drop-card h3 {
            margin-bottom: 6px;
        }
        .tool-header {
            text-align: center;
            margin-bottom: 20px;
        }
        .powered-by {
            margin-top: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .powered-by-highlight {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(26, 115, 232, 0.12);
            color: var(--primary);
            font-weight: 600;
        }
        .preview-box {
            position: relative;
            height: 180px;
            border-radius: 10px;
            overflow: hidden;
            background: linear-gradient(135deg, #f5f7fb, #e9eef6);
            border: 1px solid var(--border);
            transition: height 0.2s ease;
        }
        .preview-caption {
            position: absolute;
            top: 8px;
            left: 10px;
            font-size: 12px;
            color: var(--text-tertiary);
            background: rgba(255, 255, 255, 0.7);
            padding: 2px 8px;
            border-radius: 999px;
        }
        .watermark-overlay {
            position: absolute;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 8px;
            user-select: none;
            cursor: move;
        }
        .guide-line {
            position: absolute;
            background: rgba(26, 115, 232, 0.5);
            display: none;
            z-index: 2;
        }
        .guide-line.h {
            height: 1px;
            left: 8px;
            right: 8px;
            top: 50%;
        }
        .guide-line.v {
            width: 1px;
            top: 8px;
            bottom: 8px;
            left: 50%;
        }
        .safe-zone {
            position: absolute;
            inset: 12px;
            border: 1px dashed rgba(26, 115, 232, 0.5);
            border-radius: 8px;
            display: none;
            z-index: 2;
        }
        .watermark-overlay img {
            display: block;
            height: auto;
            border-radius: 4px;
        }
        .watermark-text {
            color: #fff;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.6);
            white-space: nowrap;
        }
        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--primary);
            border: 2px solid #fff;
            border-radius: 50%;
            right: -6px;
            bottom: -6px;
            cursor: se-resize;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        @media (max-width: 700px) {
            .grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .nav-toggle { display: flex; }
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: var(--surface);
                border-top: 1px solid var(--border);
                box-shadow: var(--shadow);
                flex-direction: column;
                padding: 1rem 0;
            }
            .nav-menu.active { display: flex; }
            .nav-menu a {
                display: block;
                padding: 16px 20px;
                border-bottom: 1px solid var(--border);
            }
        }
        .footer {
            background: var(--surface);
            border-top: 1px solid var(--border);
            margin-top: 4rem;
        }
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .footer-section h3 {
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-size: 18px;
            font-weight: 600;
        }
        .footer-section p, .footer-section a {
            color: #2d3748;
            margin-bottom: 0.5rem;
            line-height: 1.6;
            text-decoration: none;
        }
        .footer-section ul { list-style: none; }
        .footer-section ul li { margin-bottom: 0.5rem; }
        .footer-section ul li a:hover { color: var(--primary); }
        .social-links { display: flex; gap: 1rem; margin-top: 1rem; }
        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: var(--bg);
            border-radius: 50%;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        .social-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        .social-link svg { width: 20px; height: 20px; fill: currentColor; }
        .footer-bottom {
            border-top: 1px solid var(--border);
            padding: 1.5rem 0;
        }
        .footer-bottom-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .footer-left p {
            color: var(--text-tertiary);
            font-size: 14px;
            margin: 0 0 0.25rem 0;
            line-height: 1.4;
        }
        .footer-links {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }
        .footer-links a {
            color: #2d3748;
            text-decoration: none;
            font-size: 14px;
        }
        .footer-links a:hover { color: var(--primary); }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <span>Find any photo in your cloud with AI‚Äîinstantly</span>
        </div>
        <div class="header-main">
            <div class="container">
                <div class="header-content">
                    <a href="/" class="logo">
                        <img src="/static/Cloudface-ai-logo.png" alt="Cloudface AI" style="height:1.3em; width:auto; vertical-align:middle;">
                        <span style="margin-left:.4em;">Cloudface AI</span>
                    </a>
                    <button class="nav-toggle" onclick="toggleNav()" aria-label="Toggle navigation menu">
                        <svg viewBox="0 0 24 24">
                            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                        </svg>
                    </button>
                    <nav class="nav-menu" id="navMenu">
                        <a href="/" class="active">Home</a>
                        <a href="/my-photos" id="myPhotosBtn" style="display: none;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 6px; vertical-align: middle;">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <polyline points="21,15 16,10 5,21"/>
                            </svg>
                            My Photos
                        </a>
                        <a href="/about">About</a>
                        <a href="/video-app">Video Search</a>
                        <a href="/blog">Blog</a>
                        <a href="/pricing">Pricing</a>
                        <a href="/how-it-works">How It Works</a>
                        <a href="/#features">Features</a>
                        <a href="/image-tools">Image Tool</a>
                        <a href="/admin/dashboard" style="color: var(--accent); font-weight: 600;">Admin</a>
                        <a href="/app" class="cta-button">Try App</a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <div class="tool-container">
        <div class="tool-header">
            <h1>Batch Watermark</h1>
            <p class="subtitle">Upload images, apply logo + text watermark, download a ZIP.</p>
            <p class="powered-by"><span class="powered-by-highlight">Powered by imgly.ai a product of elephic technologies.</span></p>
        </div>

        <form id="watermarkForm">
            <div class="grid">
                <div class="full">
                    <label for="images">Images</label>
                    <input type="file" id="images" name="images" accept="image/*" multiple required>
                    <div class="hint">JPG, PNG, WEBP supported.</div>
                </div>
                <div>
                    <label for="watermarkText">Watermark Text (optional)</label>
                    <input type="text" id="watermarkText" name="watermark_text" placeholder="e.g., CloudFace AI">
                </div>
                <div>
                    <label for="watermarkLogo">Watermark Logo</label>
                    <input type="file" id="watermarkLogo" name="watermark_logo" accept="image/*">
                </div>
                <div>
                    <label for="watermarkPosition">Position</label>
                    <select id="watermarkPosition" name="watermark_position">
                        <option value="top-left">Top Left</option>
                        <option value="top-center">Top Center</option>
                        <option value="top-right">Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-center">Bottom Center</option>
                        <option value="bottom-right" selected>Bottom Right</option>
                    </select>
                </div>
                <div>
                    <label>Size <span id="sizeValue">15%</span></label>
                    <input type="range" id="watermarkSize" name="watermark_size" min="5" max="40" value="15">
                </div>
                <div>
                    <label>Opacity <span id="opacityValue">70%</span></label>
                    <input type="range" id="watermarkOpacity" name="watermark_opacity" min="20" max="100" value="70">
                </div>
                <div>
                    <label>Margin <span id="marginValue">12px</span></label>
                    <input type="range" id="watermarkMargin" name="watermark_margin" min="0" max="40" value="12">
                </div>
                <div class="full row" style="justify-content: space-between;">
                    <button class="btn" type="submit" id="submitBtn">Create Watermarked ZIP</button>
                    <span class="hint" id="statusText"></span>
                </div>
            </div>
            <input type="hidden" name="watermark_offset_x" id="watermarkOffsetX" value="70">
            <input type="hidden" name="watermark_offset_y" id="watermarkOffsetY" value="70">
        </form>

        <div class="preview">
            <div class="preview-box" id="previewBox">
                <div class="preview-caption">Preview</div>
                <div class="guide-line h" id="guideLineH"></div>
                <div class="guide-line v" id="guideLineV"></div>
                <div class="safe-zone" id="safeZone"></div>
                <div class="watermark-overlay" id="watermarkOverlay">
                    <img id="overlayLogo" alt="Logo">
                    <span class="watermark-text" id="overlayText">CloudFace AI</span>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About CloudFace AI</h3>
                    <p>We create AI-powered face recognition technology that helps you discover and organize photos across your digital life. Our focus is on privacy, performance, and beautiful user experience.</p>
                    <div class="social-links">
                         <a href="#" class="social-link" aria-label="Follow @whoisvinodkumar on Twitter">
                            <svg viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                         <a href="#" class="social-link" aria-label="Follow @whoisvinodkumar on Instagram">
                            <svg viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                         <a href="#" class="social-link" aria-label="Subscribe to @whoisvinodkumar on YouTube">
                            <svg viewBox="0 0 24 24">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </a>
                         <a href="#" class="social-link" aria-label="Connect with @whoisvinodkumar on LinkedIn">
                            <svg viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="/">Home</a></li>
                        <li><a href="#features">Features</a></li>
                        <li><a href="/how-it-works">How It Works</a></li>
                        <li><a href="#privacy">Privacy</a></li>
                                                 <li><a href="/#features">Pricing</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/app">Try App</a></li>
                        <li><a href="/contact">Contact Us</a></li>
                    </ul>
                </div>
                
                                 <div class="footer-section">
                     <h3>Services</h3>
                     <ul>
                         <li><a href="/#features">Face Recognition</a></li>
                         <li><a href="/#features">Photo Organization</a></li>
                         <li><a href="/#features">Google Drive Integration</a></li>
                         <li><a href="/#features">AI Processing</a></li>
                         <li><a href="/contact">Support</a></li>
                     </ul>
                 </div>
                
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        E-2/22, Block E2, <br>DLF Phase 1, Sector 26A,<br>Gurugram, Haryana<br>122003
                    </p>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                        </svg>
                        +91 9718686723
                    </p>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                        support@cloudface-ai.com
                    </p>
                    <p>
                        <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="display: inline; margin-right: 8px;">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                            <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                        </svg>
                        Mon-Fri: 10:00 AM-5:30 PM
                    </p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="footer-bottom-content">
                    <div class="footer-left">
                        <p>&copy; 2025 cloudface-ai.com. All rights reserved.</p>
                        <p>A product of Elephic Technologies</p>
                        <p>Made with <span class="heart">‚ù§</span> in Gurugram, India</p>
                    </div>
                    <div class="footer-links">
                        <a href="/privacy">Privacy Policy</a>
                        <a href="/terms">Terms & Conditions</a>
                        <a href="/pricing">Pricing</a>
                        <a href="/refund">Refund Policy</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <div class="drop-overlay" id="dropOverlay">
        <div class="drop-card">
            <h3>üî• Drop to add images</h3>
            <p>We‚Äôll load the first image for preview automatically.</p>
        </div>
    </div>

    <script>
        function toggleNav() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.toggle('active');
        }

        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('navMenu');
            const navToggle = document.querySelector('.nav-toggle');
            if (!navMenu || !navToggle) return;
            if (!navMenu.contains(event.target) && !navToggle.contains(event.target)) {
                navMenu.classList.remove('active');
            }
        });
        const sizeInput = document.getElementById('watermarkSize');
        const opacityInput = document.getElementById('watermarkOpacity');
        const marginInput = document.getElementById('watermarkMargin');
        const positionSelect = document.getElementById('watermarkPosition');
        const textInput = document.getElementById('watermarkText');
        const logoInput = document.getElementById('watermarkLogo');
        const overlay = document.getElementById('watermarkOverlay');
        const overlayLogo = document.getElementById('overlayLogo');
        const overlayText = document.getElementById('overlayText');
        const previewBox = document.getElementById('previewBox');
        const guideLineH = document.getElementById('guideLineH');
        const guideLineV = document.getElementById('guideLineV');
        const safeZone = document.getElementById('safeZone');
        const sizeValue = document.getElementById('sizeValue');
        const opacityValue = document.getElementById('opacityValue');
        const marginValue = document.getElementById('marginValue');
        const form = document.getElementById('watermarkForm');
        const submitBtn = document.getElementById('submitBtn');
        const statusText = document.getElementById('statusText');
        const dropOverlay = document.getElementById('dropOverlay');
        let customLeft = 0.7;
        let customTop = 0.7;

        function updatePreview() {
            const size = parseInt(sizeInput.value, 10);
            const opacity = parseInt(opacityInput.value, 10);
            const margin = parseInt(marginInput.value, 10);
            const position = positionSelect.value;
            const text = textInput.value.trim();

            sizeValue.textContent = `${size}%`;
            opacityValue.textContent = `${opacity}%`;
            marginValue.textContent = `${margin}px`;

            overlay.style.opacity = opacity / 100;
            overlayText.textContent = text;
            overlayText.style.display = text ? 'inline-block' : 'none';

            if (overlayLogo.src) {
                overlayLogo.style.display = 'block';
            } else {
                overlayLogo.style.display = 'none';
            }

            const baseWidth = previewBox.clientWidth || 320;
            overlayLogo.style.width = `${Math.max(28, Math.round(baseWidth * size / 100))}px`;
            overlayText.style.fontSize = `${Math.max(12, Math.round(baseWidth * (size / 100) * 0.25))}px`;

            overlay.style.left = 'auto';
            overlay.style.right = 'auto';
            overlay.style.top = 'auto';
            overlay.style.bottom = 'auto';
            overlay.style.transform = 'none';

            if (position === 'custom') {
                const maxLeft = Math.max(0, previewBox.clientWidth - overlay.offsetWidth);
                const maxTop = Math.max(0, previewBox.clientHeight - overlay.offsetHeight);
                const left = Math.round(maxLeft * customLeft);
                const top = Math.round(maxTop * customTop);
                overlay.style.left = `${left}px`;
                overlay.style.top = `${top}px`;
                document.getElementById('watermarkOffsetX').value = Math.round(customLeft * 100);
                document.getElementById('watermarkOffsetY').value = Math.round(customTop * 100);
                return;
            }

            if (position.startsWith('top')) {
                overlay.style.top = `${margin}px`;
            } else {
                overlay.style.bottom = `${margin}px`;
            }

            if (position.endsWith('left')) {
                overlay.style.left = `${margin}px`;
            } else if (position.endsWith('right')) {
                overlay.style.right = `${margin}px`;
            } else {
                overlay.style.left = '50%';
                overlay.style.transform = 'translateX(-50%)';
            }
        }

        logoInput.addEventListener('change', () => {
            const file = logoInput.files[0];
            if (!file) {
                overlayLogo.src = '';
                updatePreview();
                return;
            }
            const reader = new FileReader();
            reader.onload = e => {
                overlayLogo.src = e.target.result;
                updatePreview();
            };
            reader.readAsDataURL(file);
        });

        document.getElementById('images').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                previewBox.style.background = `url('${e.target.result}') center/cover no-repeat`;
                const img = new Image();
                img.onload = () => {
                    const maxWidth = previewBox.clientWidth || 700;
                    const ratio = img.height / img.width;
                    const desiredHeight = Math.max(180, Math.round(maxWidth * ratio));
                    previewBox.style.height = `${desiredHeight}px`;
                    updatePreview();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        });

        function showDropOverlay(show) {
            dropOverlay.style.display = show ? 'flex' : 'none';
        }

        document.addEventListener('dragover', (event) => {
            event.preventDefault();
            showDropOverlay(true);
        });

        document.addEventListener('dragleave', (event) => {
            if (event.relatedTarget === null) {
                showDropOverlay(false);
            }
        });

        document.addEventListener('drop', (event) => {
            event.preventDefault();
            showDropOverlay(false);
            const files = event.dataTransfer.files;
            if (!files || files.length === 0) return;
            const input = document.getElementById('images');
            input.files = files;
            input.dispatchEvent(new Event('change'));
        });

        [sizeInput, opacityInput, marginInput, positionSelect, textInput].forEach(el => {
            el.addEventListener('input', updatePreview);
        });

        const handle = document.createElement('span');
        handle.className = 'resize-handle';
        overlay.appendChild(handle);

        let dragging = false;
        let resizing = false;
        let dragOffsetX = 0;
        let dragOffsetY = 0;
        let startWidth = 0;
        let startHeight = 0;
        let startX = 0;
        let startY = 0;

        overlay.addEventListener('mousedown', (event) => {
            if (event.target === handle) {
                resizing = true;
                const rect = overlay.getBoundingClientRect();
                startWidth = rect.width;
                startHeight = rect.height;
                startX = event.clientX;
                startY = event.clientY;
                event.preventDefault();
                return;
            }
            dragging = true;
            guideLineH.style.display = 'block';
            guideLineV.style.display = 'block';
            safeZone.style.display = 'block';
            const rect = overlay.getBoundingClientRect();
            dragOffsetX = event.clientX - rect.left;
            dragOffsetY = event.clientY - rect.top;
            event.preventDefault();
        });

        document.addEventListener('mousemove', (event) => {
            if (dragging) {
                const boxRect = previewBox.getBoundingClientRect();
                const maxLeft = Math.max(0, previewBox.clientWidth - overlay.offsetWidth);
                const maxTop = Math.max(0, previewBox.clientHeight - overlay.offsetHeight);
                const left = Math.min(Math.max(0, event.clientX - boxRect.left - dragOffsetX), maxLeft);
                const top = Math.min(Math.max(0, event.clientY - boxRect.top - dragOffsetY), maxTop);
                overlay.style.left = `${left}px`;
                overlay.style.top = `${top}px`;
                overlay.style.right = 'auto';
                overlay.style.bottom = 'auto';
                overlay.style.transform = 'none';
                positionSelect.value = 'custom';
                customLeft = maxLeft === 0 ? 0 : left / maxLeft;
                customTop = maxTop === 0 ? 0 : top / maxTop;
                document.getElementById('watermarkOffsetX').value = Math.round(customLeft * 100);
                document.getElementById('watermarkOffsetY').value = Math.round(customTop * 100);
            }
            if (resizing) {
                const deltaX = event.clientX - startX;
                const newWidth = Math.max(80, startWidth + deltaX);
                overlayLogo.style.width = `${Math.max(28, newWidth * 0.6)}px`;
                overlayText.style.fontSize = `${Math.max(12, newWidth * 0.18)}px`;
                const baseWidth = previewBox.clientWidth || 700;
                const sizePercent = Math.max(5, Math.min(40, Math.round((newWidth / baseWidth) * 100)));
                sizeInput.value = sizePercent;
                sizeValue.textContent = `${sizePercent}%`;
            }
        });

        document.addEventListener('mouseup', () => {
            dragging = false;
            resizing = false;
            guideLineH.style.display = 'none';
            guideLineV.style.display = 'none';
            safeZone.style.display = 'none';
        });

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const formData = new FormData(form);
            formData.set('watermark_position', 'custom');
            formData.set('watermark_size', sizeInput.value);
            formData.set('watermark_offset_x', document.getElementById('watermarkOffsetX').value);
            formData.set('watermark_offset_y', document.getElementById('watermarkOffsetY').value);
            submitBtn.disabled = true;
            statusText.textContent = 'Processing...';
            try {
                const response = await fetch('/image-tools/watermark', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) {
                    const payload = await response.json();
                    throw new Error(payload.error || 'Watermark failed');
                }
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'watermarked_images.zip';
                document.body.appendChild(link);
                link.click();
                link.remove();
                window.URL.revokeObjectURL(url);
                statusText.textContent = '‚úÖ Download ready';
            } catch (error) {
                statusText.textContent = `‚ùå ${error.message}`;
            } finally {
                submitBtn.disabled = false;
                setTimeout(() => { statusText.textContent = ''; }, 4000);
            }
        });

        updatePreview();
    </script>
</body>
</html>
